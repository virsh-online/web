<?php
/** @var \App\Model\Virsh $poem */
foreach ($this('collection') as $poem): ?>
    <article class="poem-vintage">
        <div class="poem-sheet">
            <div class="poem-header">
                <h2 class="poem-title-vintage"><?= htmlspecialchars($poem('title')) ?></h2>
            </div>
            <?php if ($poem('illustration') && $poem('illustration_enabled')): ?>
            <div class="poem-body-illustration">
                <img src="<?= htmlspecialchars($poem->getIllustrationUrl()) ?>" alt="Ілюстрація до вірша">
            </div>
            <?php endif; ?>
            <div class="poem-body-vintage"><?= htmlspecialchars($poem('virsh')) ?></div>
            <?php if ($poem->getYoutube()): ?>
            <div class="poem-body-youtube">
                <iframe src="<?=  htmlspecialchars($poem->getYoutube()) ?>" allowfullscreen></iframe>
            </div>
            <?php endif; ?>
            <div class="poem-footer">Кінець</div>
        </div>
    </article>
<?php endforeach ?>

<?php if ($this('totalPages') > 1): ?>
<div class="pagination-vintage">
    <?php
    $currentPage = $this('currentPage');
    $totalPages = $this('totalPages');
    $delta = 2; // Number of pages to show on each side of current page
    
    // Previous button
    if ($currentPage > 1): ?>
        <a href="/?page=<?= $currentPage - 1 ?>" class="pagination-link pagination-prev" title="Попередня сторінка" aria-label="Попередня сторінка">←</a>
    <?php endif; ?>
    
    <div class="pagination-pages-vintage">
        <?php
        // Show first page if current page is far enough from start
        // delta + 2 means we need at least 2 pages gap (e.g., current=5: 1 ... 3,4,5)
        if ($currentPage > $delta + 2): ?>
            <a href="/?page=1" class="pagination-page-vintage">1</a>
            <?php 
            // Show ellipsis if there's a gap of more than 1 page
            if ($currentPage > $delta + 3): ?>
                <span class="pagination-ellipsis-vintage">...</span>
            <?php endif; ?>
        <?php endif;
        
        // Show pages around current page (delta pages on each side)
        for ($i = max(1, $currentPage - $delta); $i <= min($totalPages, $currentPage + $delta); $i++): ?>
            <?php if ($i == $currentPage): ?>
                <span class="pagination-page-vintage pagination-page-current"><?= $i ?></span>
            <?php else: ?>
                <a href="/?page=<?= $i ?>" class="pagination-page-vintage"><?= $i ?></a>
            <?php endif; ?>
        <?php endfor;
        
        // Show last page if current page is far enough from end
        // totalPages - delta - 1 means we need at least 2 pages gap from end
        if ($currentPage < $totalPages - $delta - 1): ?>
            <?php 
            // Show ellipsis if there's a gap of more than 1 page
            if ($currentPage < $totalPages - $delta - 2): ?>
                <span class="pagination-ellipsis-vintage">...</span>
            <?php endif; ?>
            <a href="/?page=<?= $totalPages ?>" class="pagination-page-vintage"><?= $totalPages ?></a>
        <?php endif; ?>
    </div>
    
    <?php
    // Next button
    if ($currentPage < $totalPages): ?>
        <a href="/?page=<?= $currentPage + 1 ?>" class="pagination-link pagination-next" title="Наступна сторінка" aria-label="Наступна сторінка">→</a>
    <?php endif; ?>
    
    <!-- Direct page input -->
    <div class="pagination-goto-vintage">
        <form method="get" action="/" class="pagination-goto-form-vintage">
            <label for="page-input-vintage" class="pagination-goto-label-vintage">Перейти:</label>
            <input type="number" 
                   id="page-input-vintage" 
                   name="page" 
                   min="1" 
                   max="<?= $totalPages ?>" 
                   value="<?= $currentPage ?>"
                   class="pagination-goto-input-vintage"
                   title="Введіть номер сторінки">
            <button type="submit" class="pagination-goto-btn-vintage" title="Перейти до сторінки" aria-label="Перейти до сторінки">→</button>
        </form>
    </div>
</div>
<?php endif; ?>