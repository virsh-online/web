<?php
/** @var \App\Model\Virsh $poem */
foreach ($this('collection') as $poem): ?>
    <article class="poem-vintage">
        <div class="poem-sheet">
            <div class="poem-header">
                <h2 class="poem-title-vintage"><?= htmlspecialchars($poem('title')) ?></h2>
            </div>
            <?php if ($poem('illustration') && $poem('illustration_enabled')): ?>
            <div class="poem-body-illustration">
                <img src="<?= htmlspecialchars($poem->getIllustrationUrl()) ?>" alt="Ілюстрація до вірша">
            </div>
            <?php endif; ?>
            <div class="poem-body-vintage"><?= htmlspecialchars($poem('virsh')) ?></div>
            <?php if ($poem->getYoutube()): ?>
            <div class="poem-body-youtube">
                <iframe src="<?=  htmlspecialchars($poem->getYoutube()) ?>" allowfullscreen></iframe>
            </div>
            <?php endif; ?>
            <div class="poem-footer"><?= htmlspecialchars($poem('author')) ?></div>
        </div>
    </article>
<?php endforeach ?>

<?php if ($this('totalPages') > 1): ?>
<?php
// Generate page numbers for pagination
function getPaginationPages($currentPage, $totalPages) {
    $pages = [];
    $delta = 2; // Number of pages to show around current page
    
    // Always show first page
    $pages[] = 1;
    
    // Calculate range around current page
    $rangeStart = max(2, $currentPage - $delta);
    $rangeEnd = min($totalPages - 1, $currentPage + $delta);
    
    // Add ellipsis after first page if needed
    if ($rangeStart > 2) {
        $pages[] = '...';
    }
    
    // Add pages around current page
    for ($i = $rangeStart; $i <= $rangeEnd; $i++) {
        $pages[] = $i;
    }
    
    // Add ellipsis before last page if needed
    if ($rangeEnd < $totalPages - 1) {
        $pages[] = '...';
    }
    
    // Always show last page if it's different from first page
    if ($totalPages > 1 && !in_array($totalPages, $pages)) {
        $pages[] = $totalPages;
    }
    
    return $pages;
}

$paginationPages = getPaginationPages($this('currentPage'), $this('totalPages'));
?>
<div class="pagination-vintage">
    <?php if ($this('currentPage') > 1): ?>
        <a href="/?page=<?= $this('currentPage') - 1 ?>" class="pagination-link pagination-arrow">←</a>
    <?php endif; ?>
    
    <?php foreach ($paginationPages as $page): ?>
        <?php if ($page === '...'): ?>
            <span class="pagination-ellipsis">...</span>
        <?php elseif ($page === $this('currentPage')): ?>
            <span class="pagination-current"><?= $page ?></span>
        <?php else: ?>
            <a href="/?page=<?= $page ?>" class="pagination-link"><?= $page ?></a>
        <?php endif; ?>
    <?php endforeach; ?>
    
    <?php if ($this('currentPage') < $this('totalPages')): ?>
        <a href="/?page=<?= $this('currentPage') + 1 ?>" class="pagination-link pagination-arrow">→</a>
    <?php endif; ?>
</div>
<?php endif; ?>